"use client"

import { useState } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Badge } from "@/components/ui/badge"

export interface CarSelection {
  year?: number
  modelId?: number
  modelName?: string
  chassisCode?: string
  chassisName?: string
  bodyType?: string
  engineCode?: string
  engineName?: string
  transmissionCode?: string
  transmissionName?: string
  buildDate?: string // yyyy-mm
}

interface HierarchicalCarSelectorProps {
  onSelectionChange?: (selection: CarSelection) => void
  value?: CarSelection
  className?: string
}

const YEAR_ACCURATE_BMW_DATA = {
  years: Array.from({ length: 57 }, (_, i) => (2026 - i).toString()), // Extended to 1970-2026

  modelsByYear: {
    "2026": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2025": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2024": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2023": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2022": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2021": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i4",
      "iX",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2020": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i8",
      "M2",
      "M3",
      "M4",
      "M5",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2019": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "8 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "X7",
      "Z4",
      "i3",
      "i8",
      "XM",
      "M2",
      "M3",
      "M4",
      "M5",
      "M6",
      "M8",
      "X3 M",
      "X4 M",
      "X5 M",
      "X6 M",
    ],
    "2018": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X2",
      "X3",
      "X4",
      "X5",
      "X6",
      "Z4",
      "i3",
      "i8",
      "M2",
      "M3",
      "M4",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2017": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X4",
      "X5",
      "X6",
      "Z4",
      "i3",
      "i8",
      "M2",
      "M3",
      "M4",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2016": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X4",
      "X5",
      "X6",
      "Z4",
      "i3",
      "i8",
      "M2",
      "M3",
      "M4",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2015": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X4",
      "X5",
      "X6",
      "Z4",
      "i3",
      "i8",
      "M3",
      "M4",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2014": [
      "1 Series",
      "2 Series",
      "3 Series",
      "4 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X5",
      "X6",
      "Z4",
      "i3",
      "i8",
      "M3",
      "M4",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2013": [
      "1 Series",
      "3 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X5",
      "X6",
      "Z4",
      "i3",
      "M3",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2012": [
      "1 Series",
      "3 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X5",
      "X6",
      "Z4",
      "M3",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2011": [
      "1 Series",
      "3 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X5",
      "X6",
      "Z4",
      "M3",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2010": [
      "1 Series",
      "3 Series",
      "5 Series",
      "6 Series",
      "7 Series",
      "X1",
      "X3",
      "X5",
      "X6",
      "Z4",
      "M3",
      "M5",
      "M6",
      "X5 M",
      "X6 M",
    ],
    "2009": ["1 Series", "3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "X6", "Z4", "M3", "M5", "M6"],
    "2008": ["1 Series", "3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "X6", "Z4", "M3", "M5", "M6"],
    "2007": ["1 Series", "3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "Z4", "M3", "M5", "M6"],
    "2006": ["1 Series", "3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "Z4", "M3", "M5", "M6"],
    "2005": ["1 Series", "3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "Z4", "M3", "M5", "M6"],
    "2004": ["3 Series", "5 Series", "6 Series", "7 Series", "X3", "X5", "Z4", "M3", "M5", "M6"],
    "2003": ["3 Series", "5 Series", "7 Series", "X3", "X5", "Z4", "M3", "M5"],
    "2002": ["3 Series", "5 Series", "7 Series", "X5", "Z3", "M3", "M5", "Z3 M"],
    "2001": ["3 Series", "5 Series", "7 Series", "X5", "Z3", "Z8", "M3", "M5", "Z3 M"],
    "2000": ["3 Series", "5 Series", "7 Series", "X5", "Z3", "Z8", "M3", "M5", "Z3 M"],
    "1999": ["3 Series", "5 Series", "7 Series", "8 Series", "Z3", "M3", "M5", "Z3 M"],
    "1998": ["3 Series", "5 Series", "7 Series", "8 Series", "Z3", "M3", "M5", "Z3 M"],
    "1997": ["3 Series", "5 Series", "7 Series", "8 Series", "Z3", "M3", "M5", "Z3 M"],
    "1996": ["3 Series", "5 Series", "7 Series", "8 Series", "Z3", "M3", "M5", "Z3 M"],
    "1995": ["3 Series", "5 Series", "7 Series", "8 Series", "Z3", "M3", "M5"],
    "1994": ["3 Series", "5 Series", "7 Series", "8 Series", "M3", "M5"],
    "1993": ["3 Series", "5 Series", "7 Series", "8 Series", "M3", "M5"],
    "1992": ["3 Series", "5 Series", "7 Series", "8 Series", "M3", "M5"],
    "1991": ["3 Series", "5 Series", "7 Series", "8 Series", "M3", "M5"],
    "1990": ["3 Series", "5 Series", "7 Series", "8 Series", "M3", "M5"],
    "1989": ["3 Series", "5 Series", "7 Series", "M3", "M5"],
    "1988": ["3 Series", "5 Series", "7 Series", "M3", "M5"],
    "1987": ["3 Series", "5 Series", "7 Series", "M3", "M5"],
    "1986": ["3 Series", "5 Series", "7 Series", "M5"],
    "1985": ["3 Series", "5 Series", "7 Series", "M5"],
    "1984": ["3 Series", "5 Series", "7 Series"],
    "1983": ["3 Series", "5 Series", "7 Series"],
    "1982": ["3 Series", "5 Series", "7 Series"],
    "1981": ["3 Series", "5 Series", "7 Series"],
    "1980": ["3 Series", "5 Series", "7 Series"],
    "1979": ["3 Series", "5 Series", "7 Series"],
    "1978": ["3 Series", "5 Series", "7 Series"],
    "1977": ["3 Series", "5 Series", "7 Series"],
    "1976": ["3 Series", "5 Series", "7 Series"],
    "1975": ["3 Series", "5 Series", "7 Series"],
    "1974": ["3 Series", "5 Series"],
    "1973": ["3 Series", "5 Series"],
    "1972": ["3 Series", "5 Series"],
    "1971": ["3 Series", "5 Series"],
    "1970": ["3 Series", "5 Series"],
  } as Record<string, string[]>,

  chassisByYearAndModel: {
    // M4 Example: F82/F83 (2014-2020), G82/G83 (2021+)
    "1 Series": {
      "2024": ["F40"],
      "2023": ["F40"],
      "2022": ["F40"],
      "2021": ["F40"],
      "2020": ["F40"],
      "2019": ["F40", "F20", "F21"],
      "2018": ["F20", "F21"],
      "2017": ["F20", "F21"],
      "2016": ["F20", "F21"],
      "2015": ["F20", "F21"],
      "2014": ["F20", "F21"],
      "2013": ["F20", "F21"],
      "2012": ["F20", "F21", "E82", "E87", "E88"],
      "2011": ["E82", "E87", "E88"],
      "2010": ["E82", "E87", "E88"],
      "2009": ["E82", "E87", "E88"],
      "2008": ["E82", "E87", "E88"],
      "2007": ["E82", "E87", "E88"],
      "2006": ["E87"],
      "2005": ["E87"],
      "2004": ["E87"],
    },
    "2 Series": {
      "2024": ["F44", "F45", "F46"],
      "2023": ["F44", "F45", "F46"],
      "2022": ["F44", "F45", "F46"],
      "2021": ["F44", "F45", "F46"],
      "2020": ["F44", "F22", "F23"],
      "2019": ["F22", "F23", "F45", "F46"],
      "2018": ["F22", "F23", "F45", "F46"],
      "2017": ["F22", "F23", "F45", "F46"],
      "2016": ["F22", "F23", "F45", "F46"],
      "2015": ["F22", "F23", "F45", "F46"],
      "2014": ["F22", "F23", "F45", "F46"],
    },
    M2: {
      "2024": ["G87"],
      "2023": ["G87"],
      "2022": ["G87"],
      "2021": ["F87"],
      "2020": ["F87"],
      "2019": ["F87"],
      "2018": ["F87"],
      "2017": ["F87"],
      "2016": ["F87"],
    },
    M3: {
      "2024": ["G80"],
      "2023": ["G80"],
      "2022": ["G80"],
      "2021": ["G80"],
      "2020": ["F80"],
      "2019": ["F80"],
      "2018": ["F80"],
      "2017": ["F80"],
      "2016": ["F80"],
      "2015": ["F80"],
      "2014": ["F80"],
      "2013": ["E92", "E90"],
      "2012": ["E92", "E90"],
      "2011": ["E92", "E90"],
      "2010": ["E92", "E90"],
      "2009": ["E92", "E90"],
      "2008": ["E92", "E90"],
      "2007": ["E92", "E90"],
      "2006": ["E46"],
      "2005": ["E46"],
      "2004": ["E46"],
      "2003": ["E46"],
      "2002": ["E46"],
      "2001": ["E46"],
      "2000": ["E46"],
      "1999": ["E46"],
      "1998": ["E46", "E36"],
      "1997": ["E36"],
      "1996": ["E36"],
      "1995": ["E36"],
      "1994": ["E36"],
      "1993": ["E36"],
      "1992": ["E36"],
      "1991": ["E36", "E30"],
      "1990": ["E30"],
      "1989": ["E30"],
      "1988": ["E30"],
      "1987": ["E30"],
      "1986": ["E30"],
      "1985": ["E30"],
      "1984": ["E30"],
      "1983": ["E30"],
      "1982": ["E30"],
      "1981": ["E30"],
      "1980": ["E30"],
      "1979": ["E21"],
      "1978": ["E21"],
      "1977": ["E21"],
      "1976": ["E21"],
      "1975": ["E21"],
      "1974": ["E21"],
    },
    M4: {
      "2024": ["G82", "G83"],
      "2023": ["G82", "G83"],
      "2022": ["G82", "G83"],
      "2021": ["G82", "G83"],
      "2020": ["F82", "F83", "G82", "G83"],
      "2019": ["F82", "F83", "G82", "G83"],
      "2018": ["F82", "F83"],
      "2017": ["F82", "F83"],
      "2016": ["F82", "F83"],
      "2015": ["F82", "F83"],
      "2014": ["F82", "F83"],
    },
    M5: {
      "2024": ["F90"],
      "2023": ["F90"],
      "2022": ["F90"],
      "2021": ["F90"],
      "2020": ["F90"],
      "2019": ["F90"],
      "2018": ["F90"],
      "2017": ["F90", "F10"],
      "2016": ["F10"],
      "2015": ["F10"],
      "2014": ["F10"],
      "2013": ["F10"],
      "2012": ["F10"],
      "2011": ["F10"],
      "2010": ["F10"],
      "2009": ["E60"],
      "2008": ["E60"],
      "2007": ["E60"],
      "2006": ["E60"],
      "2005": ["E60"],
      "2004": ["E60"],
      "2003": ["E39"],
      "2002": ["E39"],
      "2001": ["E39"],
      "2000": ["E39"],
    },
    M6: {
      "2019": ["F12", "F13", "F06"],
      "2018": ["F12", "F13", "F06"],
      "2017": ["F12", "F13", "F06"],
      "2016": ["F12", "F13", "F06"],
      "2015": ["F12", "F13", "F06"],
      "2014": ["F12", "F13", "F06"],
      "2013": ["F12", "F13", "F06"],
      "2012": ["F12", "F13", "F06"],
      "2011": ["F12", "F13"],
      "2010": ["E63", "E64"],
      "2009": ["E63", "E64"],
      "2008": ["E63", "E64"],
      "2007": ["E63", "E64"],
      "2006": ["E63", "E64"],
      "2005": ["E63", "E64"],
    },
    M8: {
      "2024": ["F91", "F92", "F93"],
      "2023": ["F91", "F92", "F93"],
      "2022": ["F91", "F92", "F93"],
      "2021": ["F91", "F92", "F93"],
      "2020": ["F91", "F92", "F93"],
      "2019": ["F91", "F92", "F93"],
    },
    "3 Series": {
      "2024": ["G20", "G21"],
      "2023": ["G20", "G21"],
      "2022": ["G20", "G21"],
      "2021": ["G20", "G21"],
      "2020": ["G20", "G21"],
      "2019": ["G20", "G21", "F30", "F31"],
      "2018": ["F30", "F31", "F34"],
      "2017": ["F30", "F31", "F34"],
      "2016": ["F30", "F31", "F34"],
      "2015": ["F30", "F31", "F34"],
      "2014": ["F30", "F31", "F34"],
      "2013": ["F30", "F31"],
      "2012": ["F30", "E90", "E91", "E92", "E93"],
      "2011": ["E90", "E91", "E92", "E93"],
      "2010": ["E90", "E91", "E92", "E93"],
      "2009": ["E90", "E91", "E92", "E93"],
      "2008": ["E90", "E91", "E92", "E93"],
      "2007": ["E90", "E91", "E92", "E93"],
      "2006": ["E90", "E91"],
      "2005": ["E90", "E46"],
      "2004": ["E46"],
      "2003": ["E46"],
      "2002": ["E46"],
      "2001": ["E46"],
      "2000": ["E46"],
      "1999": ["E46"],
      "1998": ["E46", "E36"],
      "1997": ["E36"],
      "1996": ["E36"],
      "1995": ["E36"],
      "1994": ["E36"],
      "1993": ["E36"],
      "1992": ["E36"],
      "1991": ["E36", "E30"],
      "1990": ["E30"],
      "1989": ["E30"],
      "1988": ["E30"],
      "1987": ["E30"],
      "1986": ["E30"],
      "1985": ["E30"],
      "1984": ["E30"],
      "1983": ["E30"],
      "1982": ["E30"],
      "1981": ["E30"],
      "1980": ["E30"],
      "1979": ["E21"],
      "1978": ["E21"],
      "1977": ["E21"],
      "1976": ["E21"],
      "1975": ["E21"],
      "1974": ["E21"],
    },
    "4 Series": {
      "2024": ["G22", "G23", "G26"],
      "2023": ["G22", "G23", "G26"],
      "2022": ["G22", "G23", "G26"],
      "2021": ["G22", "G23", "G26"],
      "2020": ["G22", "G23", "F32", "F33", "F36"],
      "2019": ["F32", "F33", "F36"],
      "2018": ["F32", "F33", "F36"],
      "2017": ["F32", "F33", "F36"],
      "2016": ["F32", "F33", "F36"],
      "2015": ["F32", "F33", "F36"],
      "2014": ["F32", "F33", "F36"],
    },
    "5 Series": {
      "2024": ["G30", "G31"],
      "2023": ["G30", "G31"],
      "2022": ["G30", "G31"],
      "2021": ["G30", "G31"],
      "2020": ["G30", "G31"],
      "2019": ["G30", "G31"],
      "2018": ["G30", "G31"],
      "2017": ["G30", "G31", "F10", "F11"],
      "2016": ["F10", "F11", "F07"],
      "2015": ["F10", "F11", "F07"],
      "2014": ["F10", "F11", "F07"],
      "2013": ["F10", "F11", "F07"],
      "2012": ["F10", "F11", "F07"],
      "2011": ["F10", "F11", "F07"],
      "2010": ["F10", "F11", "F07"],
      "2009": ["E60", "E61"],
      "2008": ["E60", "E61"],
      "2007": ["E60", "E61"],
      "2006": ["E60", "E61"],
      "2005": ["E60", "E61"],
      "2004": ["E60", "E61"],
      "2003": ["E60", "E39"],
      "2002": ["E39"],
      "2001": ["E39"],
      "2000": ["E39"],
      "1999": ["E39"],
      "1998": ["E39"],
      "1997": ["E39"],
      "1996": ["E39"],
      "1995": ["E39"],
      "1994": ["E34"],
      "1993": ["E34"],
      "1992": ["E34"],
      "1991": ["E34"],
      "1990": ["E34"],
      "1989": ["E34"],
      "1988": ["E34"],
      "1987": ["E28"],
      "1986": ["E28"],
      "1985": ["E28"],
      "1984": ["E28"],
      "1983": ["E28"],
      "1982": ["E28"],
      "1981": ["E28"],
      "1980": ["E12"],
      "1979": ["E12"],
      "1978": ["E12"],
      "1977": ["E12"],
      "1976": ["E12"],
      "1975": ["E12"],
      "1974": ["E12"],
      "1973": ["E12"],
      "1972": ["E12"],
      "1971": ["E12"],
      "1970": ["E12"],
    },
    "6 Series": {
      "2019": ["F12", "F13", "F06"],
      "2018": ["F12", "F13", "F06"],
      "2017": ["F12", "F13", "F06"],
      "2016": ["F12", "F13", "F06"],
      "2015": ["F12", "F13", "F06"],
      "2014": ["F12", "F13", "F06"],
      "2013": ["F12", "F13", "F06"],
      "2012": ["F12", "F13", "F06"],
      "2011": ["F12", "F13"],
      "2010": ["E63", "E64"],
      "2009": ["E63", "E64"],
      "2008": ["E63", "E64"],
      "2007": ["E63", "E64"],
      "2006": ["E63", "E64"],
      "2005": ["E63", "E64"],
      "2004": ["E63", "E64"],
      "2003": ["E63", "E64"],
    },
    "7 Series": {
      "2024": ["G70"],
      "2023": ["G70"],
      "2022": ["G70"],
      "2021": ["G70"],
      "2020": ["G11", "G12"],
      "2019": ["G11", "G12"],
      "2018": ["G11", "G12"],
      "2017": ["G11", "G12"],
      "2016": ["G11", "G12", "F01", "F02"],
      "2015": ["F01", "F02"],
      "2014": ["F01", "F02"],
      "2013": ["F01", "F02"],
      "2012": ["F01", "F02"],
      "2011": ["F01", "F02"],
      "2010": ["F01", "F02"],
      "2009": ["F01", "F02", "E65", "E66"],
      "2008": ["E65", "E66"],
      "2007": ["E65", "E66"],
      "2006": ["E65", "E66"],
      "2005": ["E65", "E66"],
      "2004": ["E65", "E66"],
      "2003": ["E65", "E66"],
      "2002": ["E65", "E66", "E38"],
      "2001": ["E38"],
      "2000": ["E38"],
      "1999": ["E38"],
      "1998": ["E38"],
      "1997": ["E38"],
      "1996": ["E38"],
      "1995": ["E38"],
      "1994": ["E38"],
      "1993": ["E38"],
      "1992": ["E38"],
      "1991": ["E38"],
      "1990": ["E38"],
      "1989": ["E38"],
      "1988": ["E38"],
      "1987": ["E38"],
      "1986": ["E23"],
      "1985": ["E23"],
      "1984": ["E23"],
      "1983": ["E23"],
      "1982": ["E23"],
      "1981": ["E23"],
      "1980": ["E23"],
      "1979": ["E23"],
      "1978": ["E23"],
      "1977": ["E23"],
    },
    "8 Series": {
      "2024": ["G14", "G15", "G16"],
      "2023": ["G14", "G15", "G16"],
      "2022": ["G14", "G15", "G16"],
      "2021": ["G14", "G15", "G16"],
      "2020": ["G14", "G15", "G16"],
      "2019": ["G14", "G15", "G16"],
      "1999": ["E31"],
      "1998": ["E31"],
      "1997": ["E31"],
      "1996": ["E31"],
      "1995": ["E31"],
      "1994": ["E31"],
      "1993": ["E31"],
      "1992": ["E31"],
      "1991": ["E31"],
      "1990": ["E31"],
    },
    X1: {
      "2024": ["U11"],
      "2023": ["U11"],
      "2022": ["U11", "F48"],
      "2021": ["F48"],
      "2020": ["F48"],
      "2019": ["F48"],
      "2018": ["F48"],
      "2017": ["F48"],
      "2016": ["F48"],
      "2015": ["F48"],
      "2014": ["F48"],
      "2013": ["E84"],
      "2012": ["E84"],
      "2011": ["E84"],
      "2010": ["E84"],
      "2009": ["E84"],
      "2008": ["E84"],
      "2007": ["E84"],
      "2006": ["E84"],
      "2005": ["E84"],
      "2004": ["E84"],
      "2003": ["E84"],
      "2002": ["E84"],
      "2001": ["E84"],
      "2000": ["E84"],
      "1999": ["E84"],
      "1998": ["E84"],
      "1997": ["E84"],
      "1996": ["E84"],
      "1995": ["E84"],
      "1994": ["E84"],
      "1993": ["E84"],
      "1992": ["E84"],
      "1991": ["E84"],
      "1990": ["E84"],
    },
    X2: {
      "2024": ["U10"],
      "2023": ["U10"],
      "2022": ["U10", "F39"],
      "2021": ["F39"],
      "2020": ["F39"],
      "2019": ["F39"],
      "2018": ["F39"],
    },
    X3: {
      "2024": ["G01"],
      "2023": ["G01"],
      "2022": ["G01"],
      "2021": ["G01"],
      "2020": ["G01"],
      "2019": ["G01"],
      "2018": ["G01", "F25"],
      "2017": ["F25"],
      "2016": ["F25"],
      "2015": ["F25"],
      "2014": ["F25"],
      "2013": ["F25"],
      "2012": ["F25"],
      "2011": ["F25", "E83"],
      "2010": ["E83"],
      "2009": ["E83"],
      "2008": ["E83"],
      "2007": ["E83"],
      "2006": ["E83"],
      "2005": ["E83"],
      "2004": ["E83"],
      "2003": ["E83"],
      "2002": ["E83"],
      "2001": ["E83"],
      "2000": ["E83"],
      "1999": ["E83"],
      "1998": ["E83"],
      "1997": ["E83"],
      "1996": ["E83"],
      "1995": ["E83"],
      "1994": ["E83"],
      "1993": ["E83"],
      "1992": ["E83"],
      "1991": ["E83"],
      "1990": ["E83"],
    },
    "X3 M": {
      "2024": ["F97"],
      "2023": ["F97"],
      "2022": ["F97"],
      "2021": ["F97"],
      "2020": ["F97"],
      "2019": ["F97"],
    },
    X4: {
      "2024": ["G02"],
      "2023": ["G02"],
      "2022": ["G02"],
      "2021": ["G02"],
      "2020": ["G02"],
      "2019": ["G02"],
      "2018": ["G02", "F26"],
      "2017": ["F26"],
      "2016": ["F26"],
      "2015": ["F26"],
      "2014": ["F26"],
    },
    "X4 M": {
      "2024": ["F98"],
      "2023": ["F98"],
      "2022": ["F98"],
      "2021": ["F98"],
      "2020": ["F98"],
      "2019": ["F98"],
    },
    X5: {
      "2024": ["G05"],
      "2023": ["G05"],
      "2022": ["G05"],
      "2021": ["G05"],
      "2020": ["G05"],
      "2019": ["G05"],
      "2018": ["G05", "F15"],
      "2017": ["F15"],
      "2016": ["F15"],
      "2015": ["F15"],
      "2014": ["F15"],
      "2013": ["F15"],
      "2012": ["E70"],
      "2011": ["E70"],
      "2010": ["E70"],
      "2009": ["E70"],
      "2008": ["E70"],
      "2007": ["E70", "E53"],
      "2006": ["E53"],
      "2005": ["E53"],
      "2004": ["E53"],
      "2003": ["E53"],
      "2002": ["E53"],
      "2001": ["E53"],
      "2000": ["E53"],
      "1999": ["E53"],
      "1998": ["E53"],
      "1997": ["E53"],
      "1996": ["E53"],
      "1995": ["E53"],
      "1994": ["E53"],
      "1993": ["E53"],
      "1992": ["E53"],
      "1991": ["E53"],
      "1990": ["E53"],
    },
    "X5 M": {
      "2024": ["F95"],
      "2023": ["F95"],
      "2022": ["F95"],
      "2021": ["F95"],
      "2020": ["F95"],
      "2019": ["F95"],
      "2018": ["F85"],
      "2017": ["F85"],
      "2016": ["F85"],
      "2015": ["F85"],
      "2014": ["F85"],
      "2013": ["F85"],
      "2012": ["E70"],
      "2011": ["E70"],
      "2010": ["E70"],
      "2009": ["E70"],
    },
    X6: {
      "2024": ["G06"],
      "2023": ["G06"],
      "2022": ["G06"],
      "2021": ["G06"],
      "2020": ["G06"],
      "2019": ["G06"],
      "2018": ["F16"],
      "2017": ["F16"],
      "2016": ["F16"],
      "2015": ["F16"],
      "2014": ["F16"],
      "2013": ["E71"],
      "2012": ["E71"],
      "2011": ["E71"],
      "2010": ["E71"],
      "2009": ["E71"],
      "2008": ["E71"],
    },
    "X6 M": {
      "2024": ["F96"],
      "2023": ["F96"],
      "2022": ["F96"],
      "2021": ["F96"],
      "2020": ["F96"],
      "2019": ["F96"],
      "2018": ["F86"],
      "2017": ["F86"],
      "2016": ["F86"],
      "2015": ["F86"],
      "2014": ["F86"],
      "2013": ["E71"],
      "2012": ["E71"],
      "2011": ["E71"],
      "2010": ["E71"],
      "2009": ["E71"],
      "2008": ["E71"],
    },
    X7: {
      "2024": ["G07"],
      "2023": ["G07"],
      "2022": ["G07"],
      "2021": ["G07"],
      "2020": ["G07"],
      "2019": ["G07"],
    },
    XM: {
      "2024": ["G09"],
      "2023": ["G09"],
    },
    Z3: {
      "2002": ["E36"],
      "2001": ["E36"],
      "2000": ["E36"],
      "1999": ["E36"],
      "1998": ["E36"],
      "1997": ["E36"],
      "1996": ["E36"],
      "1995": ["E36"],
      "1994": ["E36"],
      "1993": ["E36"],
      "1992": ["E36"],
      "1991": ["E36"],
      "1990": ["E36"],
    },
    "Z3 M": {
      "2002": ["E36"],
      "2001": ["E36"],
      "2000": ["E36"],
      "1999": ["E36"],
      "1998": ["E36"],
      "1997": ["E36"],
      "1996": ["E36"],
      "1995": ["E36"],
      "1994": ["E36"],
      "1993": ["E36"],
      "1992": ["E36"],
      "1991": ["E36"],
      "1990": ["E36"],
    },
    Z4: {
      "2024": ["G29"],
      "2023": ["G29"],
      "2022": ["G29"],
      "2021": ["G29"],
      "2020": ["G29"],
      "2019": ["G29"],
      "2018": ["E89"],
      "2017": ["E89"],
      "2016": ["E89"],
      "2015": ["E89"],
      "2014": ["E89"],
      "2013": ["E89"],
      "2012": ["E89"],
      "2011": ["E89"],
      "2010": ["E89"],
      "2009": ["E89", "E85", "E86"],
      "2008": ["E85", "E86"],
      "2007": ["E85", "E86"],
      "2006": ["E85", "E86"],
      "2005": ["E85", "E86"],
      "2004": ["E85"],
      "2003": ["E85"],
      "2002": ["E85"],
      "2001": ["E85"],
      "2000": ["E85"],
      "1999": ["E85"],
      "1998": ["E85"],
      "1997": ["E85"],
      "1996": ["E85"],
      "1995": ["E85"],
      "1994": ["E85"],
      "1993": ["E85"],
      "1992": ["E85"],
      "1991": ["E85"],
      "1990": ["E85"],
    },
    Z8: {
      "2001": ["E52"],
      "2000": ["E52"],
    },
    i3: {
      "2020": ["I01"],
      "2019": ["I01"],
      "2018": ["I01"],
      "2017": ["I01"],
      "2016": ["I01"],
      "2015": ["I01"],
      "2014": ["I01"],
      "2013": ["I01"],
    },
    i4: {
      "2024": ["G26"],
      "2023": ["G26"],
      "2022": ["G26"],
      "2021": ["G26"],
    },
    i8: {
      "2020": ["I12"],
      "2019": ["I12"],
      "2018": ["I12"],
      "2017": ["I12"],
      "2016": ["I12"],
      "2015": ["I12"],
      "2014": ["I12"],
    },
    iX: {
      "2024": ["I20"],
      "2023": ["I20"],
      "2022": ["I20"],
      "2021": ["I20"],
    },
  } as Record<string, Record<string, string[]>>,

  enginesByChassisAndYear: {
    // G-Series (Current Generation)
    G82: {
      "2024": ["S58"],
      "2023": ["S58"],
      "2022": ["S58"],
      "2021": ["S58"],
      "2020": ["S58"],
      "2019": ["S58"],
    },
    G83: {
      "2024": ["S58"],
      "2023": ["S58"],
      "2022": ["S58"],
      "2021": ["S58"],
      "2020": ["S58"],
      "2019": ["S58"],
    },
    G80: {
      "2024": ["S58"],
      "2023": ["S58"],
      "2022": ["S58"],
      "2021": ["S58"],
    },
    G87: {
      "2024": ["S58"],
      "2023": ["S58"],
      "2022": ["S58"],
    },
    G20: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
    },
    G21: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
    },
    G22: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
    },
    G23: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
    },
    G26: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
    },
    G30: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "B58"],
      "2017": ["B48", "B58"],
    },
    G31: {
      "2024": ["B48", "B58"],
      "2023": ["B48", "B58"],
      "2022": ["B48", "B58"],
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "B58"],
      "2017": ["B48", "B58"],
    },
    // F-Series
    F82: {
      "2020": ["S55"],
      "2019": ["S55"],
      "2018": ["S55"],
      "2017": ["S55"],
      "2016": ["S55"],
      "2015": ["S55"],
      "2014": ["S55"],
    },
    F83: {
      "2020": ["S55"],
      "2019": ["S55"],
      "2018": ["S55"],
      "2017": ["S55"],
      "2016": ["S55"],
      "2015": ["S55"],
      "2014": ["S55"],
    },
    F80: {
      "2020": ["S55"],
      "2019": ["S55"],
      "2018": ["S55"],
      "2017": ["S55"],
      "2016": ["S55"],
      "2015": ["S55"],
      "2014": ["S55"],
    },
    F87: {
      "2021": ["S55"],
      "2020": ["S55"],
      "2019": ["S55"],
      "2018": ["S55"],
      "2017": ["S55"],
      "2016": ["S55"],
    },
    F90: {
      "2024": ["S63"],
      "2023": ["S63"],
      "2022": ["S63"],
      "2021": ["S63"],
      "2020": ["S63"],
      "2019": ["S63"],
      "2018": ["S63"],
      "2017": ["S63"],
    },
    F30: {
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
      "2013": ["N20", "N26", "N55"],
      "2012": ["N20", "N26", "N55"],
    },
    F31: {
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
      "2013": ["N20", "N26", "N55"],
    },
    F32: {
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
    },
    F33: {
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
    },
    F36: {
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
    },
    F10: {
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "N55", "B58"],
      "2015": ["N20", "N55", "B58"],
      "2014": ["N20", "N55"],
      "2013": ["N20", "N55"],
      "2012": ["N20", "N55"],
      "2011": ["N52", "N55"],
      "2010": ["N52", "N55"],
    },
    F11: {
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "N55", "B58"],
      "2015": ["N20", "N55", "B58"],
      "2014": ["N20", "N55"],
      "2013": ["N20", "N55"],
      "2012": ["N20", "N55"],
      "2011": ["N52", "N55"],
      "2010": ["N52", "N55"],
    },
    // E-Series (Classic)
    E90: {
      "2012": ["N52", "N55"],
      "2011": ["N52", "N55"],
      "2010": ["N52", "N55"],
      "2009": ["N52", "N54"],
      "2008": ["N52", "N54"],
      "2007": ["N52", "N54"],
      "2006": ["N52"],
      "2005": ["N52"],
    },
    E91: {
      "2012": ["N52", "N55"],
      "2011": ["N52", "N55"],
      "2010": ["N52", "N55"],
      "2009": ["N52", "N54"],
      "2008": ["N52", "N54"],
      "2007": ["N52", "N54"],
      "2006": ["N52"],
    },
    E92: {
      "2013": ["S65"],
      "2012": ["N52", "N55", "S65"],
      "2011": ["N52", "N55", "S65"],
      "2010": ["N52", "N54", "S65"],
      "2009": ["N52", "N54", "S65"],
      "2008": ["N52", "N54", "S65"],
      "2007": ["N52", "N54", "S65"],
    },
    E93: {
      "2012": ["N52", "N55"],
      "2011": ["N52", "N55"],
      "2010": ["N52", "N54"],
      "2009": ["N52", "N54"],
      "2008": ["N52", "N54"],
      "2007": ["N52", "N54"],
    },
    E46: {
      "2006": ["S54"],
      "2005": ["M54", "S54"],
      "2004": ["M54", "S54"],
      "2003": ["M54", "S54"],
      "2002": ["M54", "S54"],
      "2001": ["M54", "S54"],
      "2000": ["M54", "S54"],
      "1999": ["M54"],
      "1998": ["M54"],
      "1997": ["M54"],
      "1996": ["M54"],
      "1995": ["M54"],
      "1994": ["M54"],
      "1993": ["M54"],
      "1992": ["M54"],
      "1991": ["M54"],
      "1990": ["M54"],
    },
    E60: {
      "2009": ["N52", "N54"],
      "2008": ["N52", "N54"],
      "2007": ["N52", "N54"],
      "2006": ["N52", "N54"],
      "2005": ["N52", "N54"],
      "2004": ["N52", "N54"],
      "2003": ["N52"],
    },
    E61: {
      "2009": ["N52", "N54"],
      "2008": ["N52", "N54"],
      "2007": ["N52", "N54"],
      "2006": ["N52", "N54"],
      "2005": ["N52", "N54"],
    },
    // Classic E-Series engines
    E21: {
      "1979": ["M10"],
      "1978": ["M10"],
      "1977": ["M10"],
      "1976": ["M10"],
      "1975": ["M10"],
      "1974": ["M10"],
      "1973": ["M10"],
      "1972": ["M10"],
      "1971": ["M10"],
      "1970": ["M10"],
    },
    E30: {
      "1991": ["M40", "M42", "S14"],
      "1990": ["M40", "M42", "S14"],
      "1989": ["M40", "M42", "S14"],
      "1988": ["M40", "M42", "S14"],
      "1987": ["M40", "S14"],
      "1986": ["M10", "M20"],
      "1985": ["M10", "M20"],
      "1984": ["M10", "M20"],
      "1983": ["M10", "M20"],
      "1982": ["M10", "M20"],
      "1981": ["M10", "M20"],
      "1980": ["M10", "M20"],
    },
    E36: {
      "1998": ["M42", "M43", "M44", "M50", "M52", "S50", "S52"],
      "1997": ["M42", "M43", "M44", "M50", "M52", "S50", "S52"],
      "1996": ["M42", "M43", "M44", "M50", "M52", "S50", "S52"],
      "1995": ["M42", "M43", "M44", "M50", "S50"],
      "1994": ["M42", "M43", "M44", "M50", "S50"],
      "1993": ["M42", "M43", "M50", "S50"],
      "1992": ["M42", "M43", "M50"],
      "1991": ["M42", "M43", "M50"],
    },
    E38: {
      "1999": ["M54"],
      "1998": ["M54"],
      "1997": ["M54"],
      "1996": ["M54"],
      "1995": ["M54"],
      "1994": ["M54"],
      "1993": ["M54"],
      "1992": ["M54"],
      "1991": ["M54"],
      "1990": ["M54"],
    },
    E32: {
      "1994": ["M54"],
      "1993": ["M54"],
      "1992": ["M54"],
      "1991": ["M54"],
      "1990": ["M54"],
    },
    E28: {
      "1987": ["M54"],
      "1986": ["M54"],
      "1985": ["M54"],
      "1984": ["M54"],
      "1983": ["M54"],
      "1982": ["M54"],
      "1981": ["M54"],
      "1980": ["M54"],
    },
    E12: {
      "1980": ["M54"],
      "1979": ["M54"],
      "1978": ["M54"],
      "1977": ["M54"],
      "1976": ["M54"],
      "1975": ["M54"],
    },
    E23: {
      "1986": ["M54"],
      "1985": ["M54"],
      "1984": ["M54"],
      "1983": ["M54"],
      "1982": ["M54"],
      "1981": ["M54"],
      "1980": ["M54"],
      "1979": ["M54"],
      "1978": ["M54"],
      "1977": ["M54"],
      "1976": ["M54"],
      "1975": ["M54"],
    },
    E31: {
      "1999": ["M54"],
      "1998": ["M54"],
      "1997": ["M54"],
      "1996": ["M54"],
      "1995": ["M54"],
      "1994": ["M54"],
      "1993": ["M54"],
      "1992": ["M54"],
      "1991": ["M54"],
      "1990": ["M54"],
    },
    F22: {
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
    },
    F23: {
      "2021": ["B48", "B58"],
      "2020": ["B48", "B58"],
      "2019": ["B48", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["N20", "B48", "N55", "B58"],
      "2016": ["N20", "B48", "N55", "B58"],
      "2015": ["N20", "B48", "N55", "B58"],
      "2014": ["N20", "N26", "N55"],
    },
    F25: {
      "2018": ["B48", "N55"],
      "2017": ["B48", "N55"],
      "2016": ["B48", "N55"],
      "2015": ["B48", "N55"],
      "2014": ["N20", "N55"],
      "2013": ["N20", "N55"],
      "2012": ["N20", "N55"],
      "2011": ["N20", "N55"],
      "2010": ["N52", "N55"],
    },
    F26: {
      "2018": ["B48", "N55"],
      "2017": ["B48", "N55"],
      "2016": ["B48", "N55"],
      "2015": ["B48", "N55"],
      "2014": ["N20", "N55"],
    },
    F15: {
      "2018": ["B48", "N55", "B58"],
      "2017": ["B48", "N55", "B58"],
      "2016": ["B48", "N55", "B58"],
      "2015": ["B48", "N55", "B58"],
      "2014": ["N20", "N55"],
      "2013": ["N20", "N55"],
    },
    F16: {
      "2019": ["B48", "N55", "B58"],
      "2018": ["B48", "N55", "B58"],
      "2017": ["B48", "N55", "B58"],
      "2016": ["B48", "N55", "B58"],
      "2015": ["B48", "N55", "B58"],
      "2014": ["N20", "N55"],
    },
    F85: {
      "2018": ["S63"],
      "2017": ["S63"],
      "2016": ["S63"],
      "2015": ["S63"],
      "2014": ["S63"],
    },
    F86: {
      "2018": ["S63"],
      "2017": ["S63"],
      "2016": ["S63"],
      "2015": ["S63"],
    },
    I01: {
      "2022": ["Electric"],
      "2021": ["Electric"],
      "2020": ["Electric"],
      "2019": ["Electric"],
      "2018": ["Electric"],
      "2017": ["Electric"],
      "2016": ["Electric"],
      "2015": ["Electric"],
      "2014": ["Electric"],
      "2013": ["Electric"],
    },
    I12: {
      "2020": ["Electric"],
      "2019": ["Electric"],
      "2018": ["Electric"],
      "2017": ["Electric"],
      "2016": ["Electric"],
      "2015": ["Electric"],
      "2014": ["Electric"],
    },
    I15: {
      "2020": ["Electric"],
      "2019": ["Electric"],
      "2018": ["Electric"],
      "2017": ["Electric"],
      "2016": ["Electric"],
      "2015": ["Electric"],
      "2014": ["Electric"],
    },
  } as Record<string, Record<string, string[]>>,

  transmissionsByEngine: {
    // Modern BMW Engines
    S58: ["6MT", "8AT"],
    S55: ["6MT", "7DCT"],
    S63: ["8AT"],
    B58: ["6MT", "8AT"],
    B48: ["6MT", "8AT"],
    N55: ["6MT", "8AT"],
    N54: ["6MT", "8AT"],
    N52: ["6MT", "8AT"],
    N20: ["6MT", "8AT"],
    N26: ["8AT"],
    // Classic BMW Engines
    S54: ["6MT"],
    S65: ["6MT", "7DCT"],
    M54: ["5MT", "6MT", "5AT"],
    M52: ["5MT", "5AT"],
    M50: ["5MT", "4AT"],
    M42: ["5MT", "4AT"],
    M40: ["5MT", "4AT"],
    // Classic engines
    M10: ["4MT", "3AT"],
    M20: ["5MT", "4AT"],
    M30: ["5MT", "4AT"],
    M43: ["5MT", "4AT"],
    S14: ["5MT"],
    S50: ["5MT", "6MT"],
    S52: ["5MT", "6MT"],
    B38: ["6MT", "8AT"],
    N13: ["6MT", "8AT"],
    M10: ["4MT", "5MT"],
    M20: ["5MT", "4AT"],
    M40: ["5MT", "4AT"],
    M42: ["5MT", "4AT"],
    M43: ["5MT", "4AT"],
    M44: ["5MT", "4AT"],
    M50: ["5MT", "4AT"],
    M52: ["5MT", "5AT"],
    S50: ["5MT"],
    S52: ["5MT", "5AT"],
    S14: ["5MT"],
    Electric: ["1AT"],
  } as Record<string, string[]>,
}

export function HierarchicalCarSelector({ onSelectionChange, value, className }: HierarchicalCarSelectorProps) {
  const [selection, setSelection] = useState<CarSelection>(value || {})

  const handleSelectionChange = (field: keyof CarSelection, newValue: string | number) => {
    const newSelection = { ...selection, [field]: newValue }

    // Reset dependent fields when parent changes
    if (field === "year") {
      newSelection.modelName = undefined
      newSelection.chassisCode = undefined
      newSelection.engineCode = undefined
      newSelection.transmissionCode = undefined
    } else if (field === "modelName") {
      newSelection.chassisCode = undefined
      newSelection.engineCode = undefined
      newSelection.transmissionCode = undefined
    } else if (field === "chassisCode") {
      newSelection.engineCode = undefined
      newSelection.transmissionCode = undefined
    } else if (field === "engineCode") {
      newSelection.transmissionCode = undefined
    }

    setSelection(newSelection)
    onSelectionChange?.(newSelection)
  }

  const availableModels = selection.year ? YEAR_ACCURATE_BMW_DATA.modelsByYear[selection.year.toString()] || [] : []

  const availableChassis =
    selection.year && selection.modelName
      ? YEAR_ACCURATE_BMW_DATA.chassisByYearAndModel[selection.modelName]?.[selection.year.toString()] || []
      : []

  const availableEngines =
    selection.year && selection.chassisCode
      ? YEAR_ACCURATE_BMW_DATA.enginesByChassisAndYear[selection.chassisCode]?.[selection.year.toString()] || []
      : []

  const availableTransmissions = selection.engineCode
    ? YEAR_ACCURATE_BMW_DATA.transmissionsByEngine[selection.engineCode] || []
    : []

  return (
    <Card className={className}>
      <CardHeader>
        <CardTitle>Select Your BMW</CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <div>
            <label className="text-sm font-medium mb-2 block">Year</label>
            <Select
              value={selection.year?.toString()}
              onValueChange={(value) => handleSelectionChange("year", Number.parseInt(value))}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select year" />
              </SelectTrigger>
              <SelectContent>
                {YEAR_ACCURATE_BMW_DATA.years.map((year) => (
                  <SelectItem key={year} value={year}>
                    {year}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium mb-2 block">Model Series</label>
            <Select
              value={selection.modelName}
              onValueChange={(value) => handleSelectionChange("modelName", value)}
              disabled={!selection.year}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select model" />
              </SelectTrigger>
              <SelectContent>
                {availableModels.map((model) => (
                  <SelectItem key={model} value={model}>
                    {model}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium mb-2 block">Chassis Code</label>
            <Select
              value={selection.chassisCode}
              onValueChange={(value) => handleSelectionChange("chassisCode", value)}
              disabled={!selection.modelName}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select chassis" />
              </SelectTrigger>
              <SelectContent>
                {availableChassis.map((chassis) => (
                  <SelectItem key={chassis} value={chassis}>
                    {chassis}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium mb-2 block">Engine Code</label>
            <Select
              value={selection.engineCode}
              onValueChange={(value) => handleSelectionChange("engineCode", value)}
              disabled={!selection.chassisCode}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select engine" />
              </SelectTrigger>
              <SelectContent>
                {availableEngines.map((engine) => (
                  <SelectItem key={engine} value={engine}>
                    {engine}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div>
            <label className="text-sm font-medium mb-2 block">Transmission</label>
            <Select
              value={selection.transmissionCode}
              onValueChange={(value) => handleSelectionChange("transmissionCode", value)}
              disabled={!selection.engineCode}
            >
              <SelectTrigger>
                <SelectValue placeholder="Select transmission" />
              </SelectTrigger>
              <SelectContent>
                {availableTransmissions.map((transmission) => (
                  <SelectItem key={transmission} value={transmission}>
                    {transmission}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        {selection.year && selection.modelName && selection.chassisCode && (
          <div className="flex flex-wrap gap-2 pt-4 border-t">
            <Badge variant="secondary">{selection.year}</Badge>
            <Badge variant="secondary">{selection.modelName}</Badge>
            <Badge variant="secondary">{selection.chassisCode}</Badge>
            {selection.engineCode && <Badge variant="secondary">{selection.engineCode}</Badge>}
            {selection.transmissionCode && <Badge variant="secondary">{selection.transmissionCode}</Badge>}
          </div>
        )}
      </CardContent>
    </Card>
  )
}

export default HierarchicalCarSelector
